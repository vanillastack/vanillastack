---
- include_tasks: configure_debian_repos.yaml

- include_tasks: kube_crio_install.yaml

- name: Run kubeadm upgrade plan
  command: kubeadm upgrade plan

- name: Run kubeadm upgrade apply v{{ kubernetes.version }}
  command: kubeadm upgrade apply --yes v{{ kubernetes.version }}

- name: Reload systemd
  systemd:
    daemon_reload: true

- name: Restart kubelet
  systemd:
    name: kubelet
    state: restarted

- name: Restart CRI-O when the packages installed changed
  systemd:
    name: crio
    state: restarted
  when:
    - crio_apt_result is defined
    - crio_apt_result.changed is defined
    - crio_apt_result.changed

- name: Sleep a few seconds for good measure
  pause:
    seconds: 5
